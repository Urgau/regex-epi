<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

        <!-- Regex Colorize -->
        <link rel="stylesheet" href="regex-colorizer.css">

        <!-- Regex -->
        <link rel="stylesheet" href="regex.css">

        <title>Regex - Workshop</title>
    </head>
    <body>
        <!-- Header bar -->
        <header class="navbar navbar-expand-lg navbar-dark sticky-top" style="background-color: #2ecc71;">
            <nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Main navigation">
                <a class="navbar-brand p-0 me-2" href="#" aria-label="Regex - Workshop">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="32" class="d-block my-1" viewBox="0 0 197.45 160"><defs><style>.cls-1{fill:#fff;}</style></defs><path class="cls-1" d="M118.17,79.35A11.76,11.76,0,0,0,120,72.58a10.83,10.83,0,0,0-2.43-7.35,11.11,11.11,0,0,0-6.86-3.54q-2.2-.3-13.29-.31H83.22V84.27H96.7q13.1,0,16.36-1.11A9.82,9.82,0,0,0,118.17,79.35Z" transform="translate(-2.78 -11.22)"/><path class="cls-1" d="M179.56,47.51V32.28a21.06,21.06,0,0,0-21.07-21.06H44.62a21,21,0,0,0-21,20.54c0-.27,0-.43,0-.43V45.8c-.83,15.6-4.8,38.47-20.78,40.36V96.33c16,1.89,20,24.33,20.78,39.64v14.19a21.06,21.06,0,0,0,21.06,21.06H158.49a21.06,21.06,0,0,0,21.07-21.06V134.29c1-15.21,5.26-36.14,20.67-38V86.16C184.82,84.34,180.58,63,179.56,47.51Zm-55.24,88.81-13.17-19.63q-7-10.51-9.59-13.26a14.11,14.11,0,0,0-5.48-3.75c-1.93-.68-5-1-9.17-1H83.22v37.65H65V46.13h38.33q14.46,0,21,2.43a20.7,20.7,0,0,1,10.49,8.64,26,26,0,0,1,3.94,14.21q0,10.16-6,16.77T115,96.51a42.39,42.39,0,0,1,9.75,7.57q3.84,4.13,10.37,14.64l11,17.6Z" transform="translate(-2.78 -11.22)"/></svg>
                </a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#rgNavbar" aria-controls="rgNavbar" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="rgNavbar">
                    <ul class="navbar-nav flex-row flex-wrap bd-navbar-nav pt-2 py-md-0">
                        <li class="nav-item col-6 col-md-auto">
                            <a class="nav-link p-2 active" aria-current="page" href="#">Home</a>
                        </li>
                        <li class="nav-item col-6 col-md-auto">
                            <a class="nav-link p-2" target='_blank' href="https://regexr.com/">RegExr</a>
                        </li>
                        <li class="nav-item col-6 col-md-auto">
                            <a class="nav-link p-2" target='_blank' href="https://regex101.com/">regex101</a>
                        </li>
                    </ul>

                    <ul class="navbar-nav flex-row flex-wrap ms-md-auto">
                        <li class="nav-item col-6 col-md-auto">
                            <a class="nav-link p-2" href="https://github.com/Urgau/regex-epi" target="_blank" rel="noopener">
                                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" class="navbar-nav-svg d-inline-block align-text-top" viewBox="0 0 512 499.36" role="img"><title>GitHub</title><path fill="currentColor" fill-rule="evenodd" d="M256 0C114.64 0 0 114.61 0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34 0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49 0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75 0 0 21.49-6.88 70.4 26.24a242.65 242.65 0 0 1 128.18 0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69 0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41 0 34.22-.31 61.83-.31 70.23 0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37 0 256 0z"></path></svg>
                                <small class="d-md-none ms-2">GitHub</small>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Main content -->
        <div class="container-xxl pt-4 rg-layout">
            <aside class="rg-sidebar">
                <nav class="collapse rg-links" aria-label="Lessons navigation">
                    <ul class="list-unstyled mb-0 py-3 pt-md-1" id="lesson-list">
                    </ul>
                </nav>
            </aside>
            <main class="rg-main" id="lesson">
                <h1 class="display-5" id="lesson-title">
                    Title
                    <a class="p-2" href="#" target="_blank" rel="noopener" id="lesson-link"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16"><path d="M4.715 6.542L3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.001 1.001 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"/><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 0 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 0 0-4.243-4.243L6.586 4.672z"/></svg></a>
                </h1>
                <p id="lesson-description">Description</p>

                <div class="input-group mb-2">
                    <span class="input-group-text">^</span>
                    <input type="text" class="form-control" id="lesson-input">
                    <span class="input-group-text">$</span>
                </div>

                <div class="alert alert-secondary regex" role="alert" id="lesson-input-colorized"></div>
                <div class="alert alert-danger" role="alert" id="lesson-label-error" hidden></div>

                <div class="container mt-5 mb-5">
                    <div class="row">
                        <div class="col">
                            <h5 class="display-5">Valid cases:</h2>
                        </div>
                        <div class="col">
                            <h5 class="display-5">Invalid cases:</h2>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <ul class="list-group" id="lesson-tests-should-pass" />
                        </div>
                        <div class="col">
                            <ul class="list-group" id="lesson-tests-should-not-pass" />
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Bottom nav -->
        <nav class="navbar navbar-light fixed-bottom bg-light">
            <div class="col-auto m-1 ms-3 me-2">
                <button type="button" class="btn btn-primary" id="lesson-btn-prev" disabled>Previous</button>
            </div>
            <div class="col my-auto">
                <div class="progress" style="height: 1.4rem">
                    <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id="lesson-current-advance">0%</div>
                </div>
            </div>
            <div class="col-auto m-1 ms-2 me-3">
                <button type="button" class="btn btn-primary" id="lesson-btn-next" disabled>Next</button>
                <button type="button" class="btn btn-primary" id="lesson-btn-finish" data-bs-toggle="modal" data-bs-target="#lesson-modal-finish" disabled hidden>Finish</button>
            </div>
        </nav>

        <!-- Modal -->
        <div class="modal fade" id="lesson-modal-finish" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLongTitle">Regex - Workshop</h5>
                    </div>
                    <div class="modal-body">
                        <p>Congratulation you have finish this workshop. :-)</p>
                        <p>You are now ready to use them in your project.</p>
                        <img src="https://media.giphy.com/media/xT0xezQGU5xCDJuCPe/giphy.gif" class="img-fluid">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Combo (Popper.js and Bootstrap JS), then the regex colorizer -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
        <script src="regex-colorizer.js"></script>

        <script>
            class Lesson {
                constructor(title, description, link, valids, invalids, solution) {
                    this.title = title;
                    this.description = description;
                    this.link = link;
                    this.valids = valids;
                    this.invalids = invalids;
                    this.solution = solution;
                }
            }

            var lessonMaxId = 0;
            var lessonCurrentId = 0;
            var lessons = [
                new Lesson("Introduction",
                    "<strong>Preamble</strong>: For all exercices we recommand that you check out and use <a target='_blank' href='https://regex101.com'>regex101</a> or <a target='_blank' href='https://regexr.com/'>RegExr</a>. These website will help you to write regex(s).</br></br><strong>How it works</strong>: You will need to enter a valid regex and pass the 'Valid cases' and 'Invalid cases' column by matching and not matching her cases. The regex will be automatically tested and all input cases should be green.</br></br>For this first exercice we want you to match the simple <em>yes</em> word.",
                    null,
                    ["yes"],
                    ["no"],
                    "yes"),
                new Lesson("Basics - Match single digit",
                    "Try to match <strong>one</strong> single digit from 0 - 9.",
                    "https://sodocumentation.net/regex/topic/343/matching-simple-patterns",
                    ["0", "5", "9"],
                    ["a", "10", "1b"],
                    "[0-9]"),
                new Lesson("Basics - Match number (more digits)",
                    "Try to match all digits.",
                    "https://sodocumentation.net/regex/topic/5916/possessive-quantifiers",
                    ["1", "12", "321", "123456"],
                    ["a", "1b", "number"],
                    "[0-9]*"),
                new Lesson("Basics - Match limited size number",
                    "Try to match all [2; 5] digits number.",
                    "https://sodocumentation.net/regex/topic/429/greedy-and-lazy-quantifiers",
                    ["10", "516", "55565"],
                    ["a", "1", "1b", "number", "666666"],
                    "[0-9]{2,5}"),
                new Lesson("Basics - Match abc",
                    "Try to match texts like <em>abc</em>, <em>aac</em>, <em>bcaabc</em>, …. Basically only strings from letters <em>a</em>, <em>b</em> or <em>c</em>.",
                    "https://sodocumentation.net/regex/topic/1757/character-classes",
                    ["abc", "cbaa", "a"],
                    ["abcd", "d", "1b"],
                    "[abc]*"),
                new Lesson("Basics - Opposite",
                    "Try to match inputs which <strong>doesn't contains</strong> the letters <em>a</em> , <em>b</em>, or <em>c</em>.",
                    "https://sodocumentation.net/regex/topic/1757/character-classes",
                    ["knowledge", "efghij", "su_ki"],
                    ["regular", "credit", "scary", ""],
                    "[^abc]+"),
                new Lesson("Basics - Match char followed by number",
                    "Try to match a character followed a number (one or more digit).",
                    null,
                    ["a0", "b277", "y9999"],
                    ["8", "98e", "io6", "s"],
                    "[a-z][0-9]+"),
                new Lesson("Basics - Match char possibly followed by number",
                    "Try to match a character followed optionally by a number.",
                    null,
                    ["a0", "b277", "y9999", "s"],
                    ["8", "98e", "io6"],
                    "[a-z][0-9]*"),
                new Lesson("Basics - Handling special characters",
                    "Try to match the character <strong>[</strong>.</br><small>Tips: it's as simple as with C</small>",
                    "https://sodocumentation.net/regex/topic/4524/escaping",
                    ["["],
                    ["a", "0", "_"],
                    "\\["),
                new Lesson("Characters ranges - Matching number < 20",
                    "Try to match numbers from <em>00</em> to <em>20</em>.</br>This number must be composed of <strong>2</strong> digits.",
                    null,
                    ["00", "03", "11", "19"],
                    ["0", "1a", "013", "20"],
                    "[0-1][0-9]"),
                new Lesson("Characters ranges - Matching letter followed by digit",
                    "Try to match a single letter followed by a single digit.</br>Letter can be from range <em>a</em> to <em>z</em> or range <em>A</em> to <em>Z</em>.</br><small>Tips: Several ranges can be put inside [ ] brakets.</small>",
                    null,
                    ["A9", "a1", "b8", "w7"],
                    ["C", "4", "Dd", "7L"],
                    "[A-Za-z][0-9]"),
                new Lesson("Characters ranges - Matching two words",
                    "The first word <strong>should only be</strong> composed from the letters range: <em>a</em> to <em>g</em>.</br>The second word <strong>should not be</strong> composed from letters range: <em>A</em> to <em>G</em>.</br><small>To simplify things in this exercice the words are separated by <strong>one</strong> and only one space.</small>",
                    null,
                    ["abcdefg MatchMe2", "a maTch4H", "def 2", "e _"],
                    ["hhh 45", "God fat", "abc ABC", "abc F", "ag"],
                    "[a-g]+ [^A-G]+"),
                new Lesson("Or matching - Basic",
                    "Try to only match the words <strong>cat</strong> and <strong>dog</strong>.",
                    null,
                    ["cat", "dog"],
                    ["pangolin", "fox", "camel", "zebre"],
                    "(cat|dog)"),
                new Lesson("Or matching - Binary",
                    "Try to match a line composed <strong>only of 0</strong> or <strong>only of 1</strong>.<br><small>Be careful to begin and end line with adapted token.</small>",
                    null,
                    ["0000", "1", "111", "0"],
                    ["0110", "2222", "1a1", "10"],
                    "(0+|1+)"),
                new Lesson("Or matching - Advanced", // ^[a-z]{2}\d{3}$|^\d{3}[a-z]{2}$
                    "Try to match a word composed by:</br><ul><li>2 characters <span class='text-muted'>followed by</span> 3 digits</li><li>3 digits <span class='text-muted'>followed by</span> 2 characters.</li></ul><small>Be careful to begin and end line with adapted token.</small>",
                    null,
                    ["ab123", "er404", "382gf", "206mk"],
                    ["abc123", "a45", "a(5)5", "9999hf"],
                    "([a-z]{2}\\d{3}|\\d{3}[a-z]{2})"),
                new Lesson("Capture groups - Basic",
                    "Try to match the letter <strong><em>a</em></strong> followed by a digit and use an <a target='_blank' href='https://javascript.info/regexp-groups'>capture group</a> to capture the digit.",
                    "https://sodocumentation.net/regex/topic/660/capture-groups",
                    [["a2", "2"], ["a9", "9"]],
                    ["ab", "9z"],
                    "a([0-9])"),
                new Lesson("Capture groups - Brackets",
                    "Try to capture all the items in the brackets <strong>[]</strong> and <strong>()</strong>.</br>If you did it fine, your group should have captured in blocks:<br><ol start='0'><li>// not important //</li><li>code</li><li>123</li></ol><small>Tips: Dont forget to escape special chars.</small>",
                    "https://sodocumentation.net/regex/topic/660/capture-groups",
                    [["Try to capture [code] and only (123) number inside.", "code", "123"], ["[thisIsAlsoAnItem] (999)", "thisIsAlsoAnItem", "999"]],
                    ["This is invalid |kk| and [ll]", "This is also invalid no ?"],
                    ".*\\[([a-zA-Z]*)\\].*\\(([0-9]*)\\).*"),
                new Lesson("Capture groups - Named",
                    "Try to capture (by name) the <i>year</i>, <i>month</i> and <i>day</i> of those dates.",
                    "https://sodocumentation.net/regex/topic/660/capture-groups",
                    [
                        ["1999-12-31", {"year": "1999", "month": "12", "day": "31"}],
                    ],
                    ["12-800-200", "000-12-31"],
                    "(?<year>[0-9]{4})-(?<month>[0-9]{2})-(?<day>[0-9]{2})"),
                new Lesson("Capture groups - Advenced",
                    "Try to capture the number that is after <strong>or</strong> or <strong>OR</strong>.",
                    "https://www.regular-expressions.info/brackets.html",
                    [["or123", "123"], ["OR333", "333"], ["or86845", "86845"]],
                    ["Or123", "oR536", "8486", "or"],
                    "(?:or|OR)(\\d+)"),
                new Lesson("Real world - Palindrome",
                    "Try to match an <strong>4 letters</strong> palindrome.<br><small>HINT: You can use capturing groups by inserting \\N - where N stands for captured group index.</small>",
                    null,
                    ["akka", "bccb", "MooM", "O00O"],
                    ["akkk", "abdc", "numberii1345", "notLetters"],
                    "(.)(.)\\2\\1"),
                new Lesson("Real world - Lookahead!",
                    "Try to match an string not containing any digits or the character <em>a</em>.<br>Plus the string <strong>must</strong> contain at least 2 characters <em>o</em> or <em>i</em>.",
                    "https://sodocumentation.net/regex/topic/639/lookahead-and-lookbehind",
                    ["no_more_numbers", "noDigits", "bcdefghiiklmnopr"],
                    ["character_oo", "ggikilap", "numberii1345", "notLetters"],
                    "[^a0-9]*([oi])[^a0-9]*\\1[^a0-9]*"),
                new Lesson("Real world - Telephone number", // \+{0,1}(\d{3} *\d{3} *|\d{4}) *\d{3} *\d{3}
                    "Try to match every valid telephone numbers.",
                    null,
                    ["+421901264523", "+421 901 264 523", "0907236542", "0907 236  542"],
                    ["notNumbers", "+france", "21 901 265 563", "09012364565", "+1234567899"],
                    "(\\+{0,1}\\d{3} *\\d{3} *|\\d{4}) *\\d{3} *\\d{3}"),
                new Lesson("Real world - Email format",
                    "Try to write a regex that verify theses emails and also capture the email domain (aka domain name).",
                    null,
                    [
                        ["name@email.com", "email.com"],
                        ["n@email.ch", "email.ch"],
                        ["a.b@m.email.com", "m.email.com"],
                        ["reg.ex@c.name", "c.name"],
                        ["valid@subdomain.mail.com", "subdomain.mail.com"],
                        ["valid.name@email.com", "email.com"]
                    ],
                    ["@mail.com", "name@.com", "name@missing", "spe*cial@mail.com", "dot.@email.com", "name@mail..com", ".name@email.com", ".@email.com", "NAME@emaIL.com"],
                    "[a-zA-Z](?:[a-zA-Z\\.]+[a-zA-Z])*@((?:\\.?[a-z]+)+\\.[a-z]{2,})"),
                new Lesson("Real world - HTML Content fetcher",
                    "Try to capture the content of the <em>TAG</em> element.",  // <TAG\b[^>]*>(.*?)<\/TAG>
                    null,
                    [
                        ["<TAG>content</TAG>", "content"],
                        ["<TAG>one<TAG>two</TAG>one</TAG>", "one<TAG>two</TAG>one"],
                        ["<TAG attr='false'>Hello</TAG>", "Hello"],
                        ["<TAG></TAG>", ""],
                        ["<TAG>></TAG>", ">"]
                    ],
                    ["<TAG>TAGccc", "<TAG qq=qbc 7/>", "<TAG>hhh<TAG>", "<TAG><TAG>", "TAG></TAG>"],
                    "<TAG\\b[^>]*>(.*?)<\\/TAG>"),
                new Lesson("Real world - HTML Content tag fetcher",
                    "Try to capture element the tag type into group 1 and the content of the tag into group 2.",  // <([a-z][a-z0-9]*)\b[^>]*>(.*?)<\/\1>
                    null,
                    [
                        ["<p>aaa</p>", "p", "aaa"],
                        ["<p test='kk' >HELLO</p>", "p", "HELLO"],
                        ["<div disabled>texte</div>", "div", "texte"],
                        ["<TAG attr='TAG'>Complex?</TAG>", "TAG", "Complex?"],
                        ["<D1v ab='D1v'>!</D1v>", "D1v", "!"],
                        ["<oo	>content</oo>", "oo", "content"]
                    ],
                    ["<p>false</div>", "</br>", "<p>missing", "<m></l>", "<1></1>", "<_div></_div>"],
                    "<([a-zA-Z][a-zA-Z0-9]*)\\b[^>]*>(.*?)<\\/\\1>"),
                new Lesson("Real world - Password",
                    "Try to validate the password based on the below criteria:\n<ul><li>at least one digital number</li><li>at least one lowercase letter</li><li>at least one uppercase letter</li><li>at least one special character</li><li>length between 8~20</li><li>should not include the un-support characters</li><li>should not include the space</li>",
                    null,
                    ["Aa@12345678", "Kecudeù*5", "HHHHHHh*^55555555"],
                    ["Aa@cccccccc", "AA@12345678", "aa@12345678", "Aa12345678", "Aa@1234", "Aa\\12345678", "Aa@123 45678"],
                    "(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[\\W|_])(?!.*[\\\\|\\/|\\s]).{8,20}"),
            ];
            var lessonInputs = (new Array(lessons.length)).fill("");

            var lessonList = document.getElementById("lesson-list");
            var lessonTitle = document.getElementById("lesson-title");
            var lessonLink = document.getElementById("lesson-link");
            var lessonInput = document.getElementById("lesson-input");
            var lessonInputColorized = document.getElementById("lesson-input-colorized");
            var lessonButtonNext = document.getElementById("lesson-btn-next");
            var lessonButtonPrev = document.getElementById("lesson-btn-prev");
            var lessonButtonFinish = document.getElementById("lesson-btn-finish");
            var lessonDescription = document.getElementById("lesson-description");
            var lessonLabelError = document.getElementById("lesson-label-error");
            var lessonCurrentAdvance = document.getElementById("lesson-current-advance");
            var lessonTestsShouldPass = document.getElementById("lesson-tests-should-pass");
            var lessonTestsShouldNotPass = document.getElementById("lesson-tests-should-not-pass");

            var urlSearchParams = new URLSearchParams(window.location.search)
            var isInSolutionMode = false;

            function createVisualTest(elements, test) {
                /*
                 *  <li class="list-group-item d-flex justify-content-between align-items-center">
                 *      Cras justo odio
                 *      <span class="badge badge-primary badge-pill">14</span>
                 *  </li>
                 */

                var name = Array.isArray(test) ? test[0] : test;
                var li = document.createElement("li");

                li.classList.add("list-group-item");
                li.classList.add("d-flex");
                li.classList.add("justify-content-between");
                li.classList.add("align-items-center");
                if (name === "")
                    li.innerText = "(empty)"
                else
                    li.innerText = name;
                li.id = "test_" + name;

                elements.appendChild(li);
            }

            function lessonBlockCreate(name, show) {
                var nameId = "block-" + name.replace(" ", "-")
                var li = document.createElement("li")
                var button = document.createElement("button")
                var div = document.createElement("div")
                var ul = document.createElement("ul")

                li.classList.add("mb-1")
                button.classList.add("btn")
                button.classList.add("d-inline-flex")
                button.classList.add("align-items-center")
                button.classList.add("rounded")
                button.classList.add("collapsed")
                div.classList.add("collapse")
                ul.classList.add("list-unstyled")
                ul.classList.add("fw-normal")
                ul.classList.add("pb-1")
                ul.classList.add("small")

                button.setAttribute("data-bs-toggle", "collapse")
                button.setAttribute("data-bs-target", "#" + nameId)
                button.innerText = name
                div.setAttribute("id", nameId)

                div.appendChild(ul)
                li.appendChild(button)
                li.appendChild(div)
                lessonList.appendChild(li)
                return ul
            }

            function lessonListGenerate(idToActive) {
                var dict = {}

                for (i = 0; i < lessons.length; i++) {
                    var outputList = lessonList;
                    var outputName = lessons[i].title;

                    if (lessons[i].title.includes(" - ")) {
                        var components = lessons[i].title.split(" - ")
                        var blockName = components[0];
                        var subBlockName = components[1];

                        if (!(blockName in dict)) {
                            dict[blockName] = lessonBlockCreate(blockName, i == idToActive)
                        }

                        outputList = dict[blockName];
                        outputName = subBlockName;
                    }

                    let li = document.createElement("li")
                    let a = document.createElement("a")

                    a.classList.add("d-inline-flex")
                    a.classList.add("align-items-center")
                    a.classList.add("rounded")
                    if (i == idToActive)
                        a.classList.add("active")

                    a.id = "lesson-link-" + i;
                    a.href = "?lesson=" + i;
                    a.innerText = outputName;
                    let aId = i;
                    a.onclick = function (e) {
                        e.preventDefault();
                        if (aId <= lessonMaxId || isInSolutionMode) {
                            displayLesson(aId);
                        } else {
                            alert("You don't have unlock this lesson!")
                        }
                    }

                    li.appendChild(a);
                    outputList.appendChild(li);
                }
            }

            function lessonButtonAttribute(btn, name, enabled) {
                if (enabled === true)
                    btn.setAttribute(name, "");
                else
                    btn.removeAttribute(name);
            }

            function displayLesson(id) {
                document.getElementById("lesson-link-" + lessonCurrentId)
                    .classList.remove("active")

                lessonInputs[lessonCurrentId] = lessonInput.value;
                lessonCurrentId = id;
                lessonMaxId = Math.max(lessonMaxId, lessonCurrentId);

                lessonTitle.childNodes[0].textContent = lessons[id].title;
                lessonLink.href = lessons[id].link == null ? "" : lessons[id].link;
                lessonDescription.innerHTML = lessons[id].description;

                lessonInput.value = isInSolutionMode === false ?
                    lessonInputs[id] : lessons[id].solution;
                lessonInputColorized.innerHTML = "";
                lessonTestsShouldPass.innerHTML = "";
                lessonTestsShouldNotPass.innerHTML = "";

                var percentage = 100 * ((id + 1) / lessons.length);
                lessonCurrentAdvance.setAttribute("style", "width: " + percentage + "%");
                lessonCurrentAdvance.setAttribute("aria-value-now", percentage);
                lessonCurrentAdvance.innerText = (id + 1) + "/" + lessons.length;

                lessons[id].valids.forEach(test => createVisualTest(lessonTestsShouldPass, test));
                lessons[id].invalids.forEach(test => createVisualTest(lessonTestsShouldNotPass, test));

                var isLast = (id + 1) === lessons.length;
                lessonButtonAttribute(lessonButtonPrev, "disabled", id == 0);
                if (isInSolutionMode === false)
                    lessonButtonAttribute(lessonButtonNext, "disabled", true);
                lessonButtonAttribute(lessonButtonNext, "hidden", isLast);
                lessonButtonAttribute(lessonButtonFinish, "hidden", !isLast);

                lessonLinkId = document.getElementById("lesson-link-" + id)
                blockLessonLi = lessonLinkId.closest("#lesson-list > li.mb-1")

                lessonLinkId.classList.add("active")
                if (blockLessonLi != null) {
                    blockLessonButton = blockLessonLi.children[0]
                    blockLessonDiv = blockLessonLi.children[1]

                    blockLessonButton.setAttribute("aria-expanded", "true")
                    blockLessonButton.classList.remove("collapsed")
                    blockLessonDiv.classList.add("show")
                }

                urlSearchParams.set("lesson", id);
                window.history.replaceState({}, document.title, "?" + urlSearchParams.toString());
                
                // lessonInput.value was changed but onchange was not trigger
                // so trigger manualy the underline function
                onTextChange();
            }

            function setTestStatus(name, status) {
                var test = document.getElementById("test_" + name);

                test.classList.remove("list-group-item-" + (status === "danger" ? "success" : "danger"));
                test.classList.add("list-group-item-" + status);
            }

            function compare(arr1, arr2) {
                if (!arr1 || !arr2) return false
                if (arr1.length !== arr2.length) return false

                for (i = 0; i < arr1.length; i++)
                    if (arr1[i] !== arr2[i])
                        return (false);
                return (true);
            }

            function compareOjects(object1, object2) {
                const keys1 = Object.keys(object1);
                const keys2 = Object.keys(object2);
                return compare(keys1, keys2);
            }

            function checkTestMatch(regex, test, cond) {
                var name = Array.isArray(test) ? test[0] : test;

                if (regex === null) {
                    setTestStatus(name, "danger");
                    return false;
                } else {
                    var result = false;

                    // Invalid test don't have expected output so we only
                    // need to check the no-matching.
                    if (Array.isArray(test) === false) {
                        result = name.match(regex) !== null;
                    } else if (test.length == 2 && test[1].constructor == Object) {
                        var rregex = new RegExp(regex);
                        var rresult = rregex.exec(name);

                        if (rresult !== null) {
                            result = compareOjects(rresult.groups, test[1]);
                        }
                    } else {
                        var matches = name.matchAll(regex);

                        for (const match of matches) {
                            result = compare(match.slice(1), test.slice(1));
                        }
                    }

                    if (cond === "invalid")
                        result = !result;
                    setTestStatus(name, result === false ? "danger" : "success");
                    return result;
                }
            }

            function onTextChange() {
                var regex = null;

                lessonInputColorized.innerHTML = RegexColorizer.colorizeText(lessonInput.value)
                try {
                    if (lessonInput.value !== "")
                        regex = new RegExp("^" + lessonInput.value + "$", "gm");

                    lessonButtonAttribute(lessonLabelError, "hidden", true);
                    lessonLabelError.innerText = "";
                } catch (error) {
                    lessonButtonAttribute(lessonLabelError, "hidden", false);
                    lessonLabelError.innerText = error;
                }

                var totalTests = 0;
                var totalTestsPass = 0;

                lessons[lessonCurrentId].valids.forEach(function (name) {
                    totalTestsPass += checkTestMatch(regex, name, "valid");
                    totalTests += 1;
                });
                lessons[lessonCurrentId].invalids.forEach(function (name) {
                    totalTestsPass += checkTestMatch(regex, name, "invalid");
                    totalTests += 1;
                });

                var enabled = totalTestsPass === totalTests;
                var btn = (lessonCurrentId + 1) === lessons.length ?
                    lessonButtonFinish : lessonButtonNext;
                lessonButtonAttribute(btn, "disabled", !enabled);
            }

            function goToPrev() {
                if (lessonCurrentId - 1 >= 0)
                    displayLesson(lessonCurrentId - 1);
            }

            function goToNext() {
                if (lessonCurrentId + 1 < lessons.length)
                    displayLesson(lessonCurrentId + 1);
            }

            lessonButtonPrev.onclick = goToPrev;
            lessonButtonNext.onclick = goToNext;

            lessonInput.onchange = onTextChange;
            lessonInput.onkeyup = function (event) {
                if (event.keyCode === 13) {
                    event.preventDefault();
                    if (lessonInput.value === "sudo") {
                        isInSolutionMode = true;
                        displayLesson(lessonCurrentId);
                        urlSearchParams.set("solution", "true");
                        window.history.replaceState({}, document.title, "?" + urlSearchParams.toString());
                    } else if (!lessonButtonNext.hasAttribute("disabled")) {
                        goToNext()
                    }
                } else {
                    onTextChange();
                }
            }

            lessonIdToStart = 0
            if (urlSearchParams.has("lesson"))
                lessonIdToStart = parseInt(urlSearchParams.get("lesson"), 10);
            isInSolutionMode = urlSearchParams.get("solution") === 'true';

            lessonListGenerate(lessonIdToStart);
            displayLesson(lessonIdToStart);
        </script>
    </body>
</html>
